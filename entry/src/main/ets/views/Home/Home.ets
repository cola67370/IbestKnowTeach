// import { router } from '@kit.ArkUI'
// import { RouterConstant } from '../../contants/RouterConstant'
// import { CommonConstant } from '../../contants/CommonConstant'
// import { ArticleComponent } from '../../components/ArticleComponent'
// import articleContentApi from '../../api/ArticleContentApi'
// import { LoadingComponent } from '../../components/LoadingComponent'
// import { ArticleContentData } from '../../api/ArticleContentApi.type'
// import { showToast } from '../../utils/Toast'
//
// @Entry
// @Component
// export struct Home {
//   // æ˜¯å¦å±•ç¤ºæœ€æ–°æ ‡é¢˜çš„ä¸‹åˆ’çº¿
//   @State newDividerShow: boolean = true
//   // æ˜¯å¦å±•ç¤ºçƒ­é—¨æ ‡é¢˜çš„ä¸‹åˆ’çº¿
//   @State hotDividerShow: boolean = false
//   // æœç´¢è¯
//   @State keyword: string = ''
//   // æ ‡é¢˜
//   @State title: string = ''
//   // æ–‡ç« æ•°æ®æ•°ç»„
//   @State articleContentList: ArticleContentData[] = []
//   // å­¦ä¹ æ‰“å¡æ€»è®°å½•æ•°
//   @State total: number = 0
//   // å½“å‰é¡µ
//   @State page: number = 1
//   // æ¯ä¸€é¡µå¤§å°
//   @State pageSize: number = 7
//   // æ§åˆ¶å½“å‰é¡µé¢å±•ç¤º
//   @State isShow: boolean = false
//   // å®šä¹‰ä¸€ä¸ªçŠ¶æ€å±æ€§ï¼Œç”¨æ¥å’ŒRefreshç»„ä»¶è¿›è¡ŒåŒå‘æ•°æ®ç»‘å®š
//   @State isRefreshing: boolean = false
//   // èŠ‚æµ, falseè¡¨ç¤ºæœªè¯·æ±‚, trueè¡¨ç¤ºæ­£åœ¨è¯·æ±‚
//   isLoad: boolean = false
//   // æ˜¯å¦å±•ç¤ºæ–‡æœ¬ï¼Œåˆ—è¡¨åˆ°åº•
//   @State textShow: boolean = false
//
//   /**
//    * ç”Ÿå‘½å‘¨æœŸå‡½æ•°
//    */
//   async aboutToAppear() {
//     // é»˜è®¤è·å–é¦–é¡µæœ€æ–°æ–‡ç« å†…å®¹
//     this.getArticleNewDataList(true, false)
//   }
//
//   /**
//    * åˆ†é¡µæŸ¥è¯¢æœ€æ–°æ–‡ç« æ•°æ®
//    */
//   async getArticleNewDataList(isFlushed: boolean, isUpdate: boolean) {
//     // åˆ†é¡µæŸ¥è¯¢æœ€æ–°æ–‡ç« æ•°æ®
//     const articleDataList =
//       await articleContentApi.getNewArticle({ page: this.page, pageSize: this.pageSize, title: this.title })
//     isFlushed ? this.articleContentList = articleDataList.records :
//     this.articleContentList.push(...articleDataList.records)
//     this.total = articleDataList.total
//     // åˆ¤æ–­æ€»æ•°æ®
//     if (this.total > this.page * this.pageSize) {
//       this.textShow = false
//     } else {
//       this.textShow = true
//     }
//     // é¡µé¢å±•ç¤º
//     this.isShow = true
//     // èŠ‚æµï¼Œé˜²æ­¢ç”¨æˆ·é‡å¤ä¸‹æ‹‰
//     this.isLoad = false
//     this.isRefreshing = false
//     // æ˜¯å¦åˆ·æ–°
//     if (isUpdate) {
//       showToast("å·²æ›´æ–°")
//     }
//   }
//
//   /**
//    * åˆ†é¡µæŸ¥è¯¢æœ€çƒ­é—¨æ–‡ç« æ•°æ®
//    */
//   async getArticleHotDataList(isFlushed: boolean, isUpdate: boolean) {
//     // åˆ†é¡µæŸ¥è¯¢æœ€çƒ­é—¨æ–‡ç« æ•°æ®
//     const articleDataList =
//       await articleContentApi.getHotArticle({ page: this.page, pageSize: this.pageSize, title: this.title })
//     isFlushed ? this.articleContentList = articleDataList.records :
//     this.articleContentList.push(...articleDataList.records)
//     this.total = articleDataList.total
//     // åˆ¤æ–­æ€»æ•°æ®
//     if (this.total > this.page * this.pageSize) {
//       this.textShow = false
//     } else {
//       this.textShow = true
//     }
//     // é¡µé¢å±•ç¤º
//     this.isShow = true
//     // èŠ‚æµï¼Œé˜²æ­¢ç”¨æˆ·é‡å¤ä¸‹æ‹‰
//     this.isLoad = false
//     this.isRefreshing = false
//     // æ˜¯å¦åˆ·æ–°
//     if (isUpdate) {
//       showToast("å·²æ›´æ–°")
//     }
//   }
//
//   /**
//    * åˆ†é¡µæŸ¥è¯¢æ–‡ç« æ•°æ®
//    */
//   async getArticleDataList(isFlushed: boolean) {
//     // åˆ†é¡µæŸ¥è¯¢æ–‡ç« æ•°æ®
//     if (this.newDividerShow) {
//       this.getArticleNewDataList(isFlushed, true)
//     }
//     if (this.hotDividerShow) {
//       this.getArticleHotDataList(isFlushed, true)
//     }
//   }
//
//   build() {
//     Column() {
//       // æ ‡é¢˜æ 
//       Row({ space: 10 }) {
//         Column() {
//           Text($r('app.string.article_best_new'))
//             .textStyles()
//           // é€‰ä¸­æ ‡é¢˜ä¼šå‡ºç°ä¸‹åˆ’çº¿
//           if (this.newDividerShow) {
//             Divider().dividerStyles()
//           }
//         }
//         .onClick(() => {
//           // å±•ç¤ºä¸‹åˆ’çº¿
//           this.hotDividerShow = false
//           this.newDividerShow = true
//           // æŸ¥è¯¢æœ€æ–°æ–‡ç« æ•°æ®
//           this.isShow = false
//           this.page = 1
//           this.getArticleNewDataList(true, true)
//         })
//
//         Column() {
//           Text($r('app.string.article_best_hot'))
//             .textStyles()
//           // é€‰ä¸­æ ‡é¢˜ä¼šå‡ºç°ä¸‹åˆ’çº¿
//           if (this.hotDividerShow) {
//             Divider().dividerStyles()
//           }
//         }
//         .onClick(() => {
//           this.newDividerShow = false
//           this.hotDividerShow = true
//           // æŸ¥è¯¢æœ€çƒ­é—¨æ–‡ç« æ•°æ®
//           this.isShow = false
//           this.page = 1
//           this.getArticleHotDataList(true, true)
//         })
//
//       }.justifyContent(FlexAlign.Start)
//       .margin({ top: 10, bottom: 20 })
//       .width(CommonConstant.WIDTH_FULL)
//
//       // æœç´¢
//       Search({ placeholder: 'è¯·è¾“å…¥å…³é”®å­—', value: $$this.keyword })
//         .placeholderFont({ size: 14 })
//         .textFont({ size: 14 })
//         .onSubmit(() => {
//           // å¤„ç†æ ‡é¢˜
//           this.title = encodeURIComponent(this.keyword)
//           // åˆ†é¡µæŸ¥è¯¢æ–‡ç« å†…å®¹
//           this.isShow = false
//           this.page = 1
//           this.getArticleDataList(true)
//         })
//         .width(CommonConstant.WIDTH_FULL)
//         .height(30)
//
//       if (this.isShow) {
//         Refresh({ refreshing: $$this.isRefreshing }) {
//           // å†…å®¹ç»„ä»¶
//           List() {
//             ForEach(this.articleContentList, (item: ArticleContentData) => {
//               ListItem() {
//                 ArticleComponent({ articleContentData: item })
//                   .onClick(() => {
//                     // è·¯ç”±åˆ°å†…å®¹è¯¦æƒ…é¡µ
//                     router.pushUrl({
//                       url: RouterConstant.VIEWS_HOME_ARTICLE_INFO, params: {
//                         "articleId": item.id
//                       }
//                     })
//                   })
//               }
//             })
//             if (this.textShow) {
//               ListItem() {
//                 Text($r('app.string.no_have_article'))
//                   .fontColor($r('app.color.common_gray'))
//                   .fontSize($r('app.float.common_font_size_small'))
//                   .width(CommonConstant.WIDTH_FULL)
//                   .textAlign(TextAlign.Center)
//                   .margin({ top: 80 })
//               }
//             }
//           }
//           .width(CommonConstant.WIDTH_FULL)
//           .height(CommonConstant.HEIGHT_FULL)
//           .scrollBar(BarState.Off)
//           .onReachEnd(() => {
//             if (!this.isLoad) {
//               if (this.total > this.page * this.pageSize) {
//                 this.isLoad = true
//                 this.page++
//                 if (this.newDividerShow) {
//                   // åˆ†é¡µæŸ¥è¯¢æœ€æ–°æ–‡ç« æ•°æ®
//                   this.getArticleNewDataList(false, false)
//                 }
//                 if (this.hotDividerShow) {
//                   // åˆ†é¡µæŸ¥è¯¢æœ€çƒ­é—¨æ–‡ç« æ•°æ®
//                   this.getArticleHotDataList(false, false)
//                 }
//               } else {
//                 this.textShow = true
//               }
//
//             }
//           })
//         }
//         .onRefreshing(() => {
//           if (!this.isLoad) {
//             this.isLoad = true
//             this.textShow = false
//             // é¡µé¢æ¢å¤åˆ°1
//             this.page = 1
//             if (this.newDividerShow) {
//               // åˆ†é¡µæŸ¥è¯¢æœ€æ–°æ–‡ç« æ•°æ®
//               this.getArticleNewDataList(true, true)
//             }
//             if (this.hotDividerShow) {
//               // åˆ†é¡µæŸ¥è¯¢æœ€çƒ­é—¨æ–‡ç« æ•°æ®
//               this.getArticleHotDataList(true, true)
//             }
//
//           }
//         })
//       } else {
//         // åŠ è½½ç»„ä»¶
//         LoadingComponent()
//       }
//
//     }.padding($r('app.float.common_padding'))
//     .height(CommonConstant.HEIGHT_FULL)
//     .width(CommonConstant.WIDTH_FULL)
//
//   }
// }
//
// @Extend(Text)
// function textStyles() {
//   .fontSize($r('app.float.common_font_size_huge'))
//   .fontWeight(FontWeight.Medium)
// }
//
// @Extend(Divider)
// function dividerStyles() {
//   .color(Color.Black)
//   .width($r('app.float.common_width_tiny'))
//   .strokeWidth(3)
// }


import prompt from '@ohos.prompt';
import { hilog } from '@kit.PerformanceAnalysisKit';

@Entry
@Component
export struct Home {
  @State isBlocking: boolean = false

  build() {
    Column() {
      Text("ğŸ  é¦–é¡µ - ä¸»çº¿ç¨‹é˜»å¡æ¼”ç¤º")
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 20 })

      Button(this.isBlocking ? "æ­£åœ¨é˜»å¡..." : "ç‚¹å‡»æ¨¡æ‹Ÿä¸»çº¿ç¨‹å¡é¡¿")
        .backgroundColor(this.isBlocking ? '#FF6B6B' : '#1698CE')
        .fontColor('#FFFFFF')
        .onClick(() => {
          if (this.isBlocking) {
            prompt.showToast({ message: 'æ­£åœ¨é˜»å¡ä¸­ï¼Œè¯·ç¨å€™â€¦' })
            return
          }
          this.simulateMainThreadBlock()
        })
        .margin({ bottom: 40 })

      Text("ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åï¼Œç•Œé¢å°†å†»ç»“çº¦3ç§’ã€‚")
        .fontSize(16)
        .fontColor('#555')
        .textAlign(TextAlign.Center)
        .width('90%')
    }
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .height('100%')
    .width('100%')
  }

  // æ¨¡æ‹Ÿä¸»çº¿ç¨‹é˜»å¡å‡½æ•°
  simulateMainThreadBlock() {
    this.isBlocking = true
    prompt.showToast({ message: 'å¼€å§‹é˜»å¡ä¸»çº¿ç¨‹ 3 ç§’...' })
    hilog.info(0x0001, 'BLOCK', 'UI blocking started')

    // åŒæ­¥å¿™å¾ªç¯3ç§’ï¼Œé˜»å¡ä¸»çº¿ç¨‹
    const start = Date.now()
    while (Date.now() - start < 3000) {
      // æ¨¡æ‹Ÿå¤æ‚è®¡ç®—ä»»åŠ¡
      Math.sqrt(Math.random() * 1000000)
    }

    hilog.info(0x0001, 'BLOCK', 'UI blocking ended')
    prompt.showToast({ message: 'é˜»å¡ç»“æŸï¼' })
    this.isBlocking = false
  }
}
